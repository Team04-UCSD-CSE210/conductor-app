<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Conductor · Course Roster</title>
  <link rel="stylesheet" href="/css/global.css">
  <link rel="stylesheet" href="/css/dashboard-global.css">
  <link rel="stylesheet" href="/css/roster.css">
</head>
<body class="dashboard-page roster-page">
  <!-- Hamburger Menu Button (mobile only) -->
  <button class="hamburger-menu" aria-label="Toggle navigation menu" aria-expanded="false">
    <span class="hamburger-line"></span>
    <span class="hamburger-line"></span>
    <span class="hamburger-line"></span>
  </button>

  <!-- Sidebar Navigation -->
  <header class="sidebar" role="navigation" aria-label="Primary navigation">
    <div class="sidebar-logo">
      <img src="/assets/temp-logo.png" alt="Conductor logo">
    </div>
    <h1 class="sidebar-title">Conductor</h1>
    
    <!-- Colorblind Mode Toggle -->
    <div class="colorblind-toggle-container">
      <label class="colorblind-toggle-label">
        <input type="checkbox" id="colorblindToggle" class="colorblind-toggle-input">
        <span class="colorblind-toggle-slider"></span>
        <span class="colorblind-toggle-text">Colorblind Mode</span>
      </label>
    </div>
    
    <div class="main-menu-header">Main Menu</div>
    <p class="sidebar-user" id="sidebarUser">
      <span class="sidebar-user-name">Loading...</span><br>
      <span class="sidebar-user-role">Loading...</span>
    </p>
    <nav aria-label="Dashboard navigation" id="sidebarNav">
      <!-- Navigation will be dynamically populated based on user role -->
    </nav>
    <footer class="sidebar-footer">
      <a href="/" class="btn btn-ghost btn-footer">Sign out</a>
    </footer>
  </header>

  <!-- Main Content -->
  <main class="main-container" id="main">
    <div class="roster-header-top">
      <div class="roster-title-section">
        <h2 class="page-title">Course Roster</h2>
        <div class="active-offering-display">
          <span class="offering-label">Active Offering:</span>
          <span class="offering-name" id="activeOfferingName">Loading...</span>
          <span class="instructor-display" id="instructorDisplay" style="margin-left: 1rem; color: var(--gray-600); font-size: 0.9rem;"></span>
          <button class="btn btn-ghost btn-sm" id="btnRefresh">⟳ Refresh</button>
        </div>
      </div>
      <div class="roster-actions">
        <div class="export-format-toggle">
          <label class="sr-only" for="exportFormat">Export format</label>
          <select id="exportFormat" class="search-input">
            <option value="csv">CSV</option>
            <option value="json">JSON</option>
          </select>
        </div>
        <button class="btn btn-soft btn-export-group" id="btnExport">Export</button>
        <button class="btn btn-soft btn-import" id="btnImportModal">Import</button>
        <button class="btn btn-primary" id="btnAddPerson">Add Person</button>
      </div>
    </div>

    <section class="stats-section">
      <div class="stats-grid" aria-live="polite">
        <article class="stat-card">
          <div class="stat-label">Total People</div>
          <div class="stat-value" id="statTotal">0</div>
          <div class="stat-chip" id="statTotalMeta"></div>
        </article>
        <article class="stat-card">
          <div class="stat-label">Students</div>
          <div class="stat-value" id="statStudents">0</div>
          <div class="stat-chip" id="statStudentsMeta"></div>
        </article>
        <article class="stat-card">
          <div class="stat-label">TAs</div>
          <div class="stat-value" id="statTAs">0</div>
          <div class="stat-chip" id="statTAsMeta"></div>
        </article>
        <article class="stat-card">
          <div class="stat-label">Tutors</div>
          <div class="stat-value" id="statTutors">0</div>
          <div class="stat-chip" id="statTutorsMeta"></div>
        </article>
      </div>
    </section>

    <section class="roster-controls">
      <div class="control-group roster-filter-bar">
        <div class="search-input-wrapper">
          <input type="search" id="search-input" class="search-input" placeholder="Search name, email, PID" aria-label="Search roster by name, email, or PID">
        </div>
        <span class="filter-divider" aria-hidden="true">|</span>
        <div class="filter-group">
          <div class="chip-group" role="group" aria-label="Role filter">
            <button class="chip" data-role-filter="all" data-active="true">All roles</button>
            <button class="chip" data-role-filter="student">Students</button>
            <button class="chip" data-role-filter="ta">TAs</button>
            <button class="chip" data-role-filter="tutor">Tutors</button>
            <button class="chip" data-role-filter="team-lead">Team Leads</button>
          </div>
        </div>
        <span class="filter-divider" aria-hidden="true">|</span>
        <div class="filter-group">
          <div class="chip-group" role="group" aria-label="Status filter">
            <button class="chip" data-status-filter="all" data-active="true">All statuses</button>
            <button class="chip" data-status-filter="enrolled">Enrolled</button>
            <button class="chip" data-status-filter="waitlisted">Waitlist</button>
            <button class="chip" data-status-filter="dropped">Dropped</button>
          </div>
        </div>
        <span class="filter-divider" aria-hidden="true">|</span>
        <div class="team-filter-group" id="teamFilterWrapper">
          <label for="teamFilterSelect" class="sr-only">Filter by team</label>
          <select id="teamFilterSelect" class="search-input team-filter-select">
            <option value="all" selected>All teams</option>
            <option value="team-leads">Team Leads</option>
          </select>
        </div>
        <button class="btn btn-ghost clear-filters-btn" id="clearFilters">Clear filters</button>
      </div>
      <div class="control-group">
        <label class="sr-only" for="sortSelect">Sort roster</label>
        <select id="sortSelect" class="search-input select-wide">
          <option value="name">Sort: A → Z</option>
          <option value="recent">Sort: Recent</option>
          <option value="role">Sort: Role</option>
          <option value="status">Sort: Status</option>
          <option value="email">Sort: Email</option>
        </select>
      </div>
    </section>

    <section class="roster-surface">
      <div id="tableView" class="table-container">
        <table aria-describedby="statTotal" class="roster-table">
          <thead>
            <tr>
              <th class="col-checkbox">
                <input type="checkbox" id="select-all" aria-label="Select all people" title="Select all">
              </th>
              <th class="col-person">Person</th>
              <th class="col-role">Course Role</th>
              <th class="col-status">Status</th>
              <th class="col-institution">Institution</th>
              <th class="col-team">Team</th>
              <th class="col-actions">Actions</th>
            </tr>
          </thead>
          <tbody id="rosterTableBody"></tbody>
        </table>
      </div>
      <div id="emptyState" class="empty-state" hidden>
        <div class="empty-state-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" opacity="0.3">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="4"/>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
          </svg>
        </div>
        <p>No people found, try clearing your search or importing additional records.</p>
      </div>
    </section>

    <section class="pagination" aria-label="Pagination controls">
      <div class="control-group">
        <button class="btn btn-soft" id="prevPage"><span aria-hidden="true">←</span> <span>Previous page</span></button>
        <button class="btn btn-soft" id="nextPage"><span>Next page</span> <span aria-hidden="true">→</span></button>
      </div>
      <div class="control-group">
        <div class="pagination-info">
          <span>Showing <strong id="showingStart">1</strong> - <strong id="showingEnd">10</strong> of <strong id="showingTotal">0</strong></span>
          <span>|</span>
          <span>Page <strong id="pageNumber">1</strong> of <strong id="totalPages">1</strong></span>
        </div>
        <label>
          <span class="sr-only">Rows per page</span>
          <select id="pageSize" class="search-input page-size-select">
            <option value="10" selected>10 / page</option>
            <option value="25">25 / page</option>
            <option value="50">50 / page</option>
            <option value="100">100 / page</option>
          </select>
        </label>
      </div>
    </section>
  </main>

  <!-- Add Person Modal -->
  <div class="modal-overlay" id="addPersonOverlay" role="dialog" aria-modal="true" aria-labelledby="addPersonTitle">
    <div class="modal">
      <header>
        <h2 id="addPersonTitle">Add a student</h2>
        <p class="modal-description">Create a student and automatically enroll them in the course.</p>
      </header>
      <section>
        <form id="addPersonForm" class="form-grid">
          <div>
            <label for="personName">Full name</label>
            <input id="personName" name="name" type="text" placeholder="e.g., Aidan Chen" required>
          </div>
          <div>
            <label for="personEmail">Email</label>
            <input id="personEmail" name="email" type="email" placeholder="aidan@ucsd.edu" required>
          </div>
          <div>
            <label for="courseRole">Course role</label>
            <select id="courseRole" name="course_role">
              <option value="student" selected>Student</option>
              <option value="ta">Teaching Assistant</option>
              <option value="tutor">Tutor</option>
              <option value="team-lead">Team Lead</option>
            </select>
          </div>
          <div>
            <label for="institutionType">Institution</label>
            <select id="institutionType" name="institution_type">
              <option value="ucsd" selected>UC San Diego</option>
              <option value="extension">Extension / Other</option>
            </select>
          </div>
          <input type="hidden" name="primary_role" value="student">
        </form>
      </section>
      <footer>
        <button class="btn btn-ghost" data-close-modal="addPersonOverlay">Cancel</button>
        <button class="btn btn-primary" type="submit" form="addPersonForm">Create &amp; enroll</button>
      </footer>
    </div>
  </div>

  <!-- Import Modal -->
  <div class="modal-overlay" id="importOverlay" role="dialog" aria-modal="true" aria-labelledby="importTitle">
    <div class="modal">
      <header>
        <h2 id="importTitle">Import roster</h2>
        <p class="modal-description">Upload CSV or paste JSON to create people in bulk.</p>
      </header>
      <section>
        <div class="chip-group" role="tablist" aria-label="Import type">
          <button class="chip" type="button" role="tab" data-import-tab="csv" data-active="true">CSV upload</button>
          <button class="chip" type="button" role="tab" data-import-tab="json">JSON payload</button>
        </div>
        <div id="csvPane" data-import-pane="csv" class="import-pane">
          <label class="form-grid">
            <span>Upload CSV file</span>
            <input type="file" id="csvInput" accept=".csv,text/csv">
          </label>
          <p class="helper-text">
            Headers supported: name, email, primary_role, status, institution_type.
          </p>
        </div>
        <div id="jsonPane" data-import-pane="json" class="import-pane" hidden>
          <label class="form-grid">
            <span>Paste JSON array</span>
            <textarea id="jsonInput" rows="6" placeholder="[{&quot;name&quot;:&quot;Ada Lovelace&quot;,&quot;email&quot;:&quot;ada@ucsd.edu&quot;}]"></textarea>
          </label>
        </div>
      </section>
      <footer>
        <button class="btn btn-ghost" data-close-modal="importOverlay">Cancel</button>
        <button class="btn btn-primary" id="btnRunImport">Run import</button>
      </footer>
    </div>
  </div>

  <!-- Edit Role Modal -->
  <div class="modal-overlay" id="roleOverlay" role="dialog" aria-modal="true" aria-labelledby="roleModalTitle">
    <div class="modal">
      <header>
        <h2 id="roleModalTitle">Update course role</h2>
        <p class="modal-description">Switch a student between student, TA, or tutor assignments.</p>
      </header>
      <section>
        <form id="roleForm" class="form-grid role-form-disabled">
          <div>
            <label for="roleStudentName">Selected person</label>
            <input id="roleStudentName" type="text" readonly>
          </div>
          <div>
            <label for="roleSelect">Course role</label>
            <select id="roleSelect" name="course_role">
              <option value="student">Student</option>
              <option value="ta">Teaching Assistant</option>
              <option value="tutor">Tutor</option>
              <option value="team-lead">Team Lead</option>
            </select>
          </div>
        </form>
      </section>
      <footer>
        <button class="btn btn-ghost" data-close-modal="roleOverlay">Cancel</button>
        <button class="btn btn-primary" id="btnSaveRole" type="submit" form="roleForm">Save role</button>
      </footer>
    </div>
  </div>

  <div class="toast-container" id="toastContainer" aria-live="polite"></div>

  <!-- Floating Bulk Actions Bar -->
  <div id="bulkActions" class="bulk-actions-bar">
    <div class="bulk-actions-info">
      <span id="selectedCount">0</span> selected
    </div>
    <div class="bulk-actions-buttons">
      <button class="btn btn-soft" id="bulkEmailBtn" title="Email selected people">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
          <polyline points="22,6 12,13 2,6"/>
        </svg>
        Email selected
      </button>
      <button class="btn btn-danger btn-icon" id="bulkDropBtn" title="Mark selected people as dropped">
        Drop selected
      </button>
    </div>
  </div>

  <script src="/js/palette-loader.js"></script>
  <script src="/js/sidebar-nav.js" defer></script>
  <script src="/js/colorblind-mode.js" defer></script>
  <script src="/js/roster.js" defer></script>
</body>
</html>
